Las tareas y el contexto son las bases del scheduler de FreeRTOS de principio determinista.

Una tarea es un bloque funcionario que tiene su propio stack en ram (contexto) y puede estar o no en tiempo de ejecucion del CPU.

Cada tarea tiene estado y prioridad (un numero entero no negativo), los estados son

- **Ready**: Listo para ejecutarse
- **Blocked**: 
	- **Event** Bloqueado hasta que ocurra el evento, o se haya agotado el tiempo de espera (numero entero de ticks)
	- **Delay**: Bloqueado por un numero entero de ticks
- **Suspended**: Suspendido indefinidamente hasta que otra tarea lo cambie.

FreeRTOS tiene un ciclo de ticks (en esp-idf 100 Hz), los delays y tiempos de espera se basan en este ciclo de ticks en vez de interrupciones directas del sistema.

Cada ciclo de tick, el Scheduler repasa todas las tareas, actualiza segun los ticks los estados de los bloqueos, y se asegura de que se ejecute a continuacion la tarea Ready de mayor prioridad.

Sin embargo el Scheduler normalmente ejecuta estos cambio de contexto por fuera del tick, debido a que una funcion de la api se ha ejecutado y requiere un cambio de contexto, por ejemplo:

- **Mayor Task**: La tarea de ejecucion ha generado una tarea de mayor prioridad, sea por poner en Ready una tarea dormida, por cambirle la prioridad a una tarea, o por crear una nueva tarea de mayor prioridad en Ready.

- **Blocked Task**: La tarea de ejecucion se ha autobloqueado o suspendido, por lo que el scheduler debe cambiar el contexto a la siguiente tarea Ready de mayor prioridad, a veces Iddle Task.

Una ISR pausa todo FreeRTOS, se ejecuta, y luego continua ejecutandose de manera normal FreeRTOS, estas tambien pueden generar una tarea de mayor prioridad, pero no bloquear una tarea. 

Se hace con las versiones de las funciones api From ISR
- **vTaskNotifyGiveFromISR()**: Desbloquea una tarea esperando notificaciÃ³n

Dado que FreeRTOS no puede hacer un cambio de contexto inmediato durante la ISR, lo haria al terminar la ISR, sin embargo se brinda una funcion api, para escoger si se desea hacer cambio de contexto inmediato o esperar al siguiente cambio de contexto natural (del tick).

Para saber si se requiere un cambio de contexto, las versiones de las funciones api From ISR, sobreescriben un valor BaseType_t xHigherPriorityTaskWoken, si se requiere cambio de contexto es pdTRUE, caso contrario pdFalse

```
BaseType_t xHigherPriorityTaskWoken = pdFALSE;
// Notifica a una tarea desde la ISR
vTaskNotifyGiveFromISR(xTaskHandle, &xHigherPriorityTaskWoken);
```

Entonces si el cambio requiere un cambio de contexto, podemos decididir si hacerlo inmediato o en el siguiente cmabio de contexto natural del (tick), con

- **portYIELD_FROM_ISR(value);**

Si value es pdTRUE, se hace cambio de contexto al terminar la ISR, caso contrario no, y se realiza en el siguiente cambio de contexto natural del (tick)




Sus funciones de la api siguen el formato de la primera letra describe el valor de retorno
vFunction (void)
xFunction (BaseType_t, depende de la arquitectura, en 32 bits -> int32_t)
ulFunction (unsigned long)

---
### LECTURES
- https://www.freertos.org/Documentation/02-Kernel/02-Kernel-features/00-Developer-docs