FreeRTOS maneja **analisis de contexto inmediato** cuando se llaman a determinadas funciones api, y **analisis de contexto periorico**, en cada **tick** (en esp-idf 100 Hz por default).

En cada analisis de contexto el scheduler se asegura de que se ejecute a continuacion la tarea **Ready** de mayor prioridad, si la tarea es diferente a la que se estaba ejecutando se dice que ha habido un cambio de contexto.

Si no hay ninguna otra tarea en **Ready**, se ejecutara la **Iddle Task** (prioridad 0).

---
### FROM TASK
Se da por la llamada a ciertas funciones api desde una tarea, e implica un **analisis de contexto inmediato**.

Debido a que solo la tarea **Running** estaba en ejecucion, es la unica que pudo haber generado un cambio que requiera un cambio de contexto, por ello la funcion api a la que llama puede determinar automaticamente si se requiere o no el cambio de contexto.

---
#### BLOCKED TASK
Si la tarea **Running** se ha autobloqueado o autosuspendido, la funcion api debe analizar el resto de tareas **Ready** para poner en **Running** la siguiente de mayor prioridad.

---
#### MAYOR TASK
Si la tarea **Running** ha generado otra tarea en **Ready**, la funcion api solo necesita comparar sus prioridades para evaluar si hay cambio de contexto, casos:

- Poner en Ready una tarea dormida.
- Cambiarle la prioridad a una tarea.
- Crear una tarea.

---
### FROM ISR
Se da por la llamada a ciertas funciones api desde una **ISR,** e implica un **analisis de contexto inmediato**, pero para el cambio de contexto puede elegir entre **inmediato** o **periodico**.

Una **ISR** pausa todo FreeRTOS, se ejecuta, y luego continua ejecutandose de manera normal FreeRTOS, pueden poner en **Ready** tareas dormidas, o suspender tareas.

Se hace con las versiones de las funciones api From ISR, estas sobreescriben ademas un (BaseType_t) xHigherPriorityTaskWoken para indiciar el analisis de contexto.

---
#### portYIELD_FROM_ISR
Mientras se ejecuta la **ISR** FreeRTOS no puede hacer un cambio de contexto, debe esperar a que se termine, debido a que sino todo el funcionamiento de FreeRTOS quedaria encapsulado en el codigo de la ISR (inestable).

Segun el **analisis de contexto inmediato** devuelto, podemos indicarle a FreeRTOS si deseamos realizar un cambio de contexto inmediato, o esperar al periodico.

```
Cambio de contexto inmediato
portYIELD_FROM_ISR(pdTRUE);

Esperar al periodico
portYIELD_FROM_ISR(pdFALSE);
```
